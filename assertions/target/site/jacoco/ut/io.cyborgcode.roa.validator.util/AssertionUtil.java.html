<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AssertionUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Ring of Automation Assertion Library</a> &gt; <a href="index.source.html" class="el_package">io.cyborgcode.roa.validator.util</a> &gt; <span class="el_source">AssertionUtil.java</span></div><h1>AssertionUtil.java</h1><pre class="source lang-java linenums">package io.cyborgcode.roa.validator.util;

import io.cyborgcode.roa.validator.core.Assertion;
import io.cyborgcode.roa.validator.core.AssertionResult;
import io.cyborgcode.roa.validator.core.AssertionType;
import io.cyborgcode.roa.validator.exceptions.InvalidAssertionException;
import io.cyborgcode.roa.validator.registry.AssertionRegistry;
import java.util.List;
import java.util.Map;

/**
 * Utility class for executing and validating assertions against provided data.
 *
 * &lt;p&gt;This class processes assertions, validates input data, and applies the appropriate validation
 * logic. It ensures compatibility between expected and actual values before evaluation.
 *
 * &lt;p&gt;Assertions are applied based on registered validation functions, and the results
 * are returned as {@link AssertionResult} objects.
 *
 * @author Cyborg Code Syndicate üíçüë®üíª
 */
public final class AssertionUtil {

   private AssertionUtil() {
   }


   /**
    * Validates a set of assertions against a given data map.
    *
    * @param data       The data map containing key-value pairs to validate against.
    * @param assertions The list of assertions to be applied.
    * @param &lt;T&gt;        The type of values being validated.
    * @return A list of {@link AssertionResult} objects representing validation outcomes.
    * @throws IllegalArgumentException if the data map is null or no assertions are provided.
    */
   public static &lt;T&gt; List&lt;AssertionResult&lt;T&gt;&gt; validate(Map&lt;String, T&gt; data, List&lt;Assertion&gt; assertions) {
<span class="fc bfc" id="L38" title="All 2 branches covered.">      if (data == null) {</span>
<span class="fc" id="L39">         throw new IllegalArgumentException(&quot;The data map cannot be null.&quot;);</span>
      }
<span class="fc bfc" id="L41" title="All 4 branches covered.">      if (assertions == null || assertions.isEmpty()) {</span>
<span class="fc" id="L42">         throw new IllegalArgumentException(&quot;At least one assertion must be provided.&quot;);</span>
      }

<span class="fc" id="L45">      return assertions.stream().map(assertion -&gt; validateSingle(data, assertion)).toList();</span>
   }


   /**
    * Validates a single assertion against the data map.
    *
    * @param data      The data map containing key-value pairs.
    * @param assertion The assertion to be validated.
    * @param &lt;T&gt;       The type of the value being validated.
    * @return An {@link AssertionResult} indicating whether the assertion passed or failed.
    * @throws IllegalArgumentException if the key does not exist or has a null value.
    */
   private static &lt;T&gt; AssertionResult&lt;T&gt; validateSingle(Map&lt;String, T&gt; data, Assertion assertion) {
<span class="fc" id="L59">      validateAssertion(assertion);</span>

<span class="fc" id="L61">      String key = assertion.getKey();</span>
<span class="fc" id="L62">      T actualValue = data.get(key);</span>

<span class="fc bfc" id="L64" title="All 2 branches covered.">      if (actualValue == null) {</span>
<span class="fc" id="L65">         throw new IllegalArgumentException(</span>
<span class="fc" id="L66">               String.format(&quot;Key '%s' in assertion does not exist or has a null value in the data map.&quot;, key)</span>
         );
      }

<span class="fc" id="L70">      AssertionType&lt;?&gt; type = assertion.getType();</span>
<span class="fc" id="L71">      validateTypeCompatibility(type, actualValue);</span>

<span class="fc" id="L73">      var validator = AssertionRegistry.getValidator(type);</span>
<span class="fc" id="L74">      boolean passed = validator.test(actualValue, assertion.getExpected());</span>

<span class="fc" id="L76">      return new AssertionResult&lt;&gt;(</span>
            passed,
<span class="fc" id="L78">            type.type().name(),</span>
<span class="fc" id="L79">            assertion.getExpected(),</span>
            actualValue,
<span class="fc" id="L81">            assertion.isSoft()</span>
      );
   }


   /**
    * Ensures that the given assertion is valid.
    *
    * @param assertion The assertion to validate.
    * @throws InvalidAssertionException if any required field in the assertion is missing or null.
    */
   private static void validateAssertion(Assertion assertion) {
<span class="fc bfc" id="L93" title="All 2 branches covered.">      if (assertion == null) {</span>
<span class="fc" id="L94">         throw new InvalidAssertionException(&quot;Assertion cannot be null.&quot;);</span>
      }

<span class="fc bfc" id="L97" title="All 4 branches covered.">      if (assertion.getKey() == null || assertion.getKey().isEmpty()) {</span>
<span class="fc" id="L98">         throw new InvalidAssertionException(&quot;Assertion must have a non-empty key.&quot;);</span>
      }
<span class="fc" id="L100">   }</span>


   /**
    * Validates type compatibility between an assertion type and the actual value.
    *
    * @param type        The assertion type.
    * @param actualValue The actual value to be validated.
    * @throws IllegalArgumentException if the actual value type does not match the expected type.
    */
   private static void validateTypeCompatibility(AssertionType&lt;?&gt; type, Object actualValue) {
<span class="fc" id="L111">      Class&lt;?&gt; supportedType = type.getSupportedType();</span>
<span class="fc" id="L112">      Class&lt;?&gt; actualValueClass = actualValue.getClass();</span>

<span class="fc bfc" id="L114" title="All 2 branches covered.">      if (!supportedType.isAssignableFrom(actualValueClass)) {</span>
<span class="fc" id="L115">         throw new IllegalArgumentException(</span>
<span class="fc" id="L116">               String.format(</span>
                     &quot;Assertion type '%s' is not compatible with the actual value type '%s'.&quot;,
<span class="fc" id="L118">                     type, actualValueClass.getName()</span>
               )
         );
      }
<span class="fc" id="L122">   }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>