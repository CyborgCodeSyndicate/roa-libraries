<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RipperMan.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Ring of Automation Core Test Framework</a> &gt; <a href="index.source.html" class="el_package">io.cyborgcode.roa.framework.extension</a> &gt; <span class="el_source">RipperMan.java</span></div><h1>RipperMan.java</h1><pre class="source lang-java linenums">package io.cyborgcode.roa.framework.extension;

import io.cyborgcode.roa.framework.annotation.Ripper;
import io.cyborgcode.roa.framework.decorators.DecoratorsFactory;
import io.cyborgcode.roa.framework.log.LogQuest;
import io.cyborgcode.roa.framework.parameters.DataRipper;
import io.cyborgcode.roa.framework.quest.Quest;
import io.cyborgcode.roa.framework.quest.SuperQuest;
import io.cyborgcode.roa.framework.storage.StorageKeysTest;
import io.cyborgcode.utilities.reflections.ReflectionUtil;
import java.util.Arrays;
import org.junit.jupiter.api.extension.AfterTestExecutionCallback;
import org.junit.jupiter.api.extension.ExtensionContext;
import org.springframework.context.ApplicationContext;
import org.springframework.test.context.junit.jupiter.SpringExtension;

import static io.cyborgcode.roa.framework.config.FrameworkConfigHolder.getFrameworkConfig;
import static io.cyborgcode.roa.framework.storage.StoreKeys.QUEST;

/**
 * JUnit 5 {@code AfterTestExecutionCallback} extension that handles post-test execution cleanup.
 *
 * &lt;p&gt;This extension processes test data cleanup using the {@code Ripper} annotation, ensuring
 * that any specified targets are properly eliminated after the test execution.
 *
 * @author Cyborg Code Syndicate üíçüë®üíª
 */
<span class="fc" id="L28">public class RipperMan implements AfterTestExecutionCallback {</span>

   /**
    * Executes after the test method finishes execution.
    *
    * &lt;p&gt;This method checks if the test method is annotated with {@code Ripper} and invokes the
    * corresponding cleanup logic for the specified targets.
    *
    * @param context The test execution context containing metadata about the test.
    * @throws Exception If any error occurs during post-test execution cleanup.
    */
   @Override
   public void afterTestExecution(final ExtensionContext context) throws Exception {
<span class="fc" id="L41">      context.getTestMethod().ifPresent(method -&gt; {</span>
<span class="fc" id="L42">         Ripper annotation = method.getAnnotation(Ripper.class);</span>
<span class="fc bfc" id="L43" title="All 2 branches covered.">         if (annotation != null) {</span>
<span class="fc" id="L44">            executeRipperLogic(context, annotation.targets());</span>
         }
<span class="fc" id="L46">      });</span>
<span class="fc" id="L47">   }</span>

   /**
    * Executes cleanup logic for the specified targets defined in the {@code Ripper} annotation.
    *
    * &lt;p&gt;This method retrieves the necessary test context, resolves dependencies,
    * and invokes the corresponding data elimination operations.
    *
    * @param context The test execution context.
    * @param targets The targets specified in the {@code Ripper} annotation for cleanup.
    */
   private void executeRipperLogic(ExtensionContext context, String[] targets) {
<span class="fc" id="L59">      LogQuest.info(&quot;The ripper has arrived&quot;);</span>

<span class="fc" id="L61">      ApplicationContext appCtx = SpringExtension.getApplicationContext(context);</span>
<span class="fc" id="L62">      DecoratorsFactory decoratorsFactory = appCtx.getBean(DecoratorsFactory.class);</span>
<span class="fc" id="L63">      Quest quest = (Quest) context.getStore(ExtensionContext.Namespace.GLOBAL).get(QUEST);</span>
<span class="fc" id="L64">      SuperQuest superQuest = decoratorsFactory.decorate(quest, SuperQuest.class);</span>
<span class="fc bfc" id="L65" title="All 2 branches covered.">      if (quest == null) {</span>
<span class="fc" id="L66">         throw new IllegalStateException(&quot;Quest not found in the global store&quot;);</span>
      }

<span class="fc" id="L69">      superQuest.getStorage().sub(StorageKeysTest.ARGUMENTS).createLateArguments();</span>

<span class="fc" id="L71">      Arrays.stream(targets).forEach(target -&gt; {</span>
<span class="fc" id="L72">         DataRipper&lt;?&gt; dataRipper = ReflectionUtil.findEnumImplementationsOfInterface(</span>
<span class="fc" id="L73">               DataRipper.class, target, getFrameworkConfig().projectPackages());</span>

<span class="fc" id="L75">         dataRipper.eliminate().accept(superQuest);</span>
<span class="fc" id="L76">         LogQuest.info(&quot;DataRipper processed target: '{}'.&quot;, target);</span>
<span class="fc" id="L77">      });</span>
<span class="fc" id="L78">   }</span>

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>