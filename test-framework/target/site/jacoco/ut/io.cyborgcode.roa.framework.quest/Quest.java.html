<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Quest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Ring of Automation Core Test Framework</a> &gt; <a href="index.source.html" class="el_package">io.cyborgcode.roa.framework.quest</a> &gt; <span class="el_source">Quest.java</span></div><h1>Quest.java</h1><pre class="source lang-java linenums">package io.cyborgcode.roa.framework.quest;


import io.cyborgcode.roa.framework.annotation.Ring;
import io.cyborgcode.roa.framework.assertion.CustomSoftAssertion;
import io.cyborgcode.roa.framework.chain.FluentService;
import io.cyborgcode.roa.framework.log.LogQuest;
import io.cyborgcode.roa.framework.storage.Storage;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;

import static io.cyborgcode.utilities.reflections.ReflectionUtil.getFieldValues;

/**
 * Manages the execution flow and data storage for test scenarios.
 *
 * &lt;p&gt;This class acts as the central controller for executing test operations,
 * managing service interactions, and storing data during a test run.
 * It allows transitioning between different testing contexts (rings) and
 * ensures test completion with proper validations.
 *
 * @author Cyborg Code Syndicate üíçüë®üíª
 */
public class Quest {

   /**
    * Stores registered test services, mapping their types to instances.
    */
<span class="fc" id="L31">   private final Map&lt;Class&lt;? extends FluentService&gt;, FluentService&gt; rings = new HashMap&lt;&gt;();</span>

   /**
    * Storage instance for temporarily holding test data within a test execution.
    */
   private final Storage storage;

   /**
    * Handles soft assertions for validation checks during the test execution.
    */
<span class="fc" id="L41">   private final CustomSoftAssertion softAssertions = new CustomSoftAssertion();</span>

   /**
    * Initializes a new {@code Quest} instance with a fresh storage object.
    */
<span class="fc" id="L46">   public Quest() {</span>
<span class="fc" id="L47">      this.storage = new Storage();</span>
<span class="fc" id="L48">   }</span>

   /**
    * Transitions the test execution context into the specified ring (test service).
    *
    * &lt;p&gt;This method retrieves a registered service by its class type and allows the test execution
    * to proceed within that context.
    *
    * @param ring The class type of the desired test service.
    * @param &lt;T&gt;  The type of the fluent service.
    * @return The corresponding fluent service instance.
    * @throws IllegalArgumentException If the specified ring is not registered.
    */
   @SuppressWarnings(&quot;unchecked&quot;)
   public &lt;T extends FluentService&gt; T use(Class&lt;T&gt; ring) {
<span class="fc" id="L63">      Optional&lt;Class&lt;? extends FluentService&gt;&gt; match =</span>
<span class="fc" id="L64">            rings.keySet().stream().filter(ring::isAssignableFrom).findFirst();</span>
<span class="fc bfc" id="L65" title="All 2 branches covered.">      if (match.isEmpty()) {</span>
<span class="fc" id="L66">         throw new IllegalArgumentException(&quot;Ring not initialized: &quot; + ring.getName());</span>
      }
<span class="fc" id="L68">      Ring ringName = ring.getAnnotation(Ring.class);</span>

<span class="fc bfc" id="L70" title="All 2 branches covered.">      String message = ringName == null</span>
<span class="fc" id="L71">            ? &quot;The quest has used the ring: '&quot; + ring.getName() + &quot;'&quot;</span>
<span class="fc" id="L72">            : &quot;The quest has used the ring: '&quot; + ringName.value() + &quot;'&quot;;</span>

<span class="fc" id="L74">      LogQuest.info(message);</span>
<span class="fc" id="L75">      return (T) rings.get(match.get());</span>
   }

   /**
    * Retrieves a registered fluent service without modifying the execution context.
    *
    * @param ringType The class type of the service to retrieve.
    * @param &lt;T&gt;       The type of the fluent service.
    * @return The corresponding service instance.
    * @throws IllegalArgumentException If the specified ring is not registered.
    */
   @SuppressWarnings(&quot;unchecked&quot;)
   protected &lt;T extends FluentService&gt; T cast(Class&lt;T&gt; ringType) {
<span class="fc" id="L88">      Optional&lt;Class&lt;? extends FluentService&gt;&gt; match =</span>
<span class="fc" id="L89">            rings.keySet().stream().filter(ringType::isAssignableFrom).findFirst();</span>
<span class="fc bfc" id="L90" title="All 2 branches covered.">      if (match.isEmpty()) {</span>
<span class="fc" id="L91">         throw new IllegalArgumentException(&quot;Ring not initialized: &quot; + ringType.getName());</span>
      }
<span class="fc" id="L93">      return (T) rings.get(match.get());</span>
   }

   /**
    * Marks the completion of the test execution.
    *
    * &lt;p&gt;This method logs the completion, clears the test execution state, and verifies all
    * soft assertions collected during the test execution.
    */
   public void complete() {
<span class="fc" id="L103">      LogQuest.info(&quot;The quest has reached his end&quot;);</span>
<span class="fc" id="L104">      QuestHolder.clear();</span>
<span class="fc" id="L105">      softAssertions.assertAll();</span>
<span class="fc" id="L106">   }</span>

   /**
    * Retrieves an artifact associated with a specific test service.
    *
    * &lt;p&gt;This method extracts an instance of the specified artifact type from the
    * requested test service.
    *
    * @param ringType    The class type of the test service.
    * @param artifactType The class type of the artifact to retrieve.
    * @param &lt;T&gt;          The type of the test service.
    * @param &lt;K&gt;          The type of the artifact.
    * @return The retrieved artifact instance.
    * @throws IllegalArgumentException If input parameters are null.
    * @throws IllegalStateException    If the requested ring is not available.
    */
   protected &lt;T extends FluentService, K&gt; K artifact(Class&lt;T&gt; ringType, Class&lt;K&gt; artifactType) {
<span class="fc bfc" id="L123" title="All 4 branches covered.">      if (ringType == null || artifactType == null) {</span>
<span class="fc" id="L124">         throw new IllegalArgumentException(&quot;Parameters ringType and artifactType must not be null.&quot;);</span>
      }

<span class="fc" id="L127">      T ring = cast(ringType);</span>
<span class="fc bfc" id="L128" title="All 2 branches covered.">      if (ring == null) {</span>
<span class="fc" id="L129">         throw new IllegalStateException(</span>
<span class="fc" id="L130">               &quot;Could not retrieve an instance of the specified ringType: &quot; + ringType.getName());</span>
      }

<span class="fc" id="L133">      List&lt;K&gt; fieldValues = getFieldValues(ring, artifactType);</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">      if (fieldValues.size() &gt; 1) {</span>
<span class="fc" id="L135">         LogQuest.warn(</span>
               &quot;There is more than one artifact from type: {} inside class: {}. The first one will be taken: {}&quot;,
<span class="fc" id="L137">               artifactType, ringType, fieldValues.get(0));</span>
      }
<span class="fc" id="L139">      return fieldValues.get(0);</span>
   }

   /**
    * Registers a new test service into the current execution context.
    *
    * @param ringType The class type of the test service.
    * @param ring     The instance of the test service.
    */
   protected void registerRing(Class&lt;? extends FluentService&gt; ringType, FluentService ring) {
<span class="fc" id="L149">      rings.put(ringType, ring);</span>
<span class="fc" id="L150">   }</span>

   /**
    * Removes a test service from the current execution context.
    *
    * @param ringType The class type of the test service to remove.
    */
   protected void removeRing(Class&lt;? extends FluentService&gt; ringType) {
<span class="fc" id="L158">      rings.remove(ringType);</span>
<span class="fc" id="L159">   }</span>

   /**
    * Provides access to the storage instance for managing temporary test data.
    *
    * @return The storage instance.
    */
   protected Storage getStorage() {
<span class="fc" id="L167">      return storage;</span>
   }

   /**
    * Provides access to the soft assertion handler for managing test validations.
    *
    * @return The soft assertion handler.
    */
   protected CustomSoftAssertion getSoftAssertions() {
<span class="fc" id="L176">      return softAssertions;</span>
   }

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>