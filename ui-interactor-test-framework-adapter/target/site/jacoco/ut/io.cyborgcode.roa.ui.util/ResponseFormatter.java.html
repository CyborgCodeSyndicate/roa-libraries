<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ResponseFormatter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Ring of Automation UI Test Framework</a> &gt; <a href="index.source.html" class="el_package">io.cyborgcode.roa.ui.util</a> &gt; <span class="el_source">ResponseFormatter.java</span></div><h1>ResponseFormatter.java</h1><pre class="source lang-java linenums">package io.cyborgcode.roa.ui.util;

import io.cyborgcode.roa.framework.util.ResourceLoader;
import io.cyborgcode.roa.ui.components.interceptor.ApiResponse;
import java.util.List;
import java.util.Objects;

import static io.cyborgcode.roa.framework.util.ObjectFormatter.escapeHtml;

/**
 * Utility class for converting API responses into an HTML representation.
 *
 * &lt;p&gt;Provides methods to summarize a list of {@link ApiResponse} objects‚Äîcounting total,
 * successful, warning, and error responses‚Äîand to build detailed accordion-style
 * HTML blocks for each response, with proper HTML escaping.
 *
 * @author Cyborg Code Syndicate üíçüë®üíª
 */
public final class ResponseFormatter {

   public static final String DIV_CLOSE = &quot;&lt;/div&gt;&quot;;

   private ResponseFormatter() {
   }

   /**
    * Formats a list of responses into an HTML string, summarizing request counts and formatting individual responses.
    *
    * @param responses a list of response objects, which may include lists of responses
    * @return a string containing the generated HTML with formatted responses
    */
   public static String formatResponses(List&lt;ApiResponse&gt; responses) {

<span class="fc" id="L34">      List&lt;ApiResponse&gt; formattedResponses = responses.stream()</span>
<span class="fc" id="L35">            .map(response -&gt; {</span>
               try {
<span class="fc" id="L37">                  ApiResponse copy = new ApiResponse(response.getUrl(), response.getMethod(), response.getStatus());</span>
<span class="fc" id="L38">                  String body = response.getBody();</span>
<span class="fc bfc" id="L39" title="All 4 branches covered.">                  if (body != null &amp;&amp; body.length() &gt; 10000) {</span>
<span class="fc" id="L40">                     copy.setBody(body.substring(0, 1000) + &quot;...&quot;);</span>
                  } else {
<span class="fc" id="L42">                     copy.setBody(body);</span>
                  }
<span class="fc" id="L44">                  return copy;</span>
<span class="fc" id="L45">               } catch (Exception e) {</span>
<span class="fc" id="L46">                  return null;</span>
               }
            })
<span class="fc" id="L49">            .filter(Objects::nonNull)</span>
<span class="fc" id="L50">            .toList();</span>

<span class="fc" id="L52">      int totalRequests = 0;</span>
<span class="fc" id="L53">      int successCount = 0;</span>
<span class="fc" id="L54">      int warningCount = 0;</span>
<span class="fc" id="L55">      int errorCount = 0;</span>

<span class="fc bfc" id="L57" title="All 2 branches covered.">      for (ApiResponse response : formattedResponses) {</span>
<span class="fc" id="L58">         totalRequests++;</span>
<span class="fc" id="L59">         int status = response.getStatus();</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">         if (status &gt;= 400) {</span>
<span class="fc" id="L61">            errorCount++;</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">         } else if (status &gt;= 300) {</span>
<span class="fc" id="L63">            warningCount++;</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">         } else if (status &gt; 0) {</span>
<span class="fc" id="L65">            successCount++;</span>
         }
<span class="fc" id="L67">      }</span>

<span class="fc" id="L69">      String templateHtml = ResourceLoader.loadResourceFile(&quot;allure/html/intercepted-responses.html&quot;);</span>
<span class="fc" id="L70">      StringBuilder htmlBuilder = new StringBuilder(</span>
<span class="fc" id="L71">            templateHtml.replace(&quot;{{total}}&quot;, String.valueOf(totalRequests))</span>
<span class="fc" id="L72">                  .replace(&quot;{{success}}&quot;, String.valueOf(successCount))</span>
<span class="fc" id="L73">                  .replace(&quot;{{warning}}&quot;, String.valueOf(warningCount))</span>
<span class="fc" id="L74">                  .replace(&quot;{{error}}&quot;, String.valueOf(errorCount)));</span>

<span class="fc bfc" id="L76" title="All 2 branches covered.">      for (int i = 0; i &lt; formattedResponses.size(); i++) {</span>
<span class="fc" id="L77">         appendResponseAccordion(htmlBuilder, formattedResponses.get(i), i);</span>
      }

<span class="fc" id="L80">      return htmlBuilder.toString();</span>
   }


   /**
    * Appends an accordion HTML block for a given response to the provided StringBuilder.
    *
    * @param html     the StringBuilder to append the HTML content to
    * @param response the response object to format
    * @param index    the index used to uniquely identify the accordion elements
    */
   private static void appendResponseAccordion(StringBuilder html, ApiResponse response, int index) {
      try {

<span class="fc" id="L94">         String url = response.getUrl();</span>
<span class="fc" id="L95">         String method = response.getMethod();</span>
<span class="fc" id="L96">         int status = response.getStatus();</span>
<span class="fc" id="L97">         String body = response.getBody();</span>

<span class="fc" id="L99">         String statusClass = &quot;status-success&quot;;</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">         if (status &gt;= 400) {</span>
<span class="fc" id="L101">            statusClass = &quot;status-error&quot;;</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">         } else if (status &gt;= 300) {</span>
<span class="fc" id="L103">            statusClass = &quot;status-warning&quot;;</span>
         }

<span class="fc" id="L106">         String endpoint = extractEndpoint(url);</span>

<span class="fc" id="L108">         html.append(&quot;&lt;div class='accordion'&gt;&quot;)</span>
<span class="fc" id="L109">               .append(&quot;&lt;div class='accordion-header' id='header-&quot;).append(index)</span>
<span class="fc" id="L110">               .append(&quot;' onclick='toggleAccordion(&quot;).append(index).append(&quot;)'&gt;&quot;)</span>
<span class="fc" id="L111">               .append(&quot;&lt;div class='method'&gt;&quot;).append(method).append(DIV_CLOSE)</span>
<span class="fc" id="L112">               .append(&quot;&lt;div class='url'&gt;&quot;).append(endpoint).append(DIV_CLOSE)</span>
<span class="fc" id="L113">               .append(&quot;&lt;div class='status &quot;).append(statusClass).append(&quot;'&gt;&quot;)</span>
<span class="fc" id="L114">               .append(status).append(DIV_CLOSE)</span>
<span class="fc" id="L115">               .append(&quot;&lt;span class='chevron'&gt;&amp;#9660;&lt;/span&gt;&quot;)</span>
<span class="fc" id="L116">               .append(DIV_CLOSE)</span>
<span class="fc" id="L117">               .append(&quot;&lt;div id='content-&quot;).append(index).append(&quot;' class='accordion-content'&gt;&quot;)</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">               .append(&quot;&lt;pre&gt;&quot;).append(escapeHtml(body != null ? body : &quot;&quot;)).append(&quot;&lt;/pre&gt;&quot;)</span>
<span class="fc" id="L119">               .append(DIV_CLOSE)</span>
<span class="fc" id="L120">               .append(DIV_CLOSE);</span>
<span class="nc" id="L121">      } catch (Exception ignore) {</span>
         //ignore exception
<span class="fc" id="L123">      }</span>
<span class="fc" id="L124">   }</span>


   /**
    * Extracts the endpoint path from a URL string.
    *
    * @param url the full URL string
    * @return the endpoint path if available, or the original URL if extraction fails
    */
   private static String extractEndpoint(String url) {
      try {
<span class="fc" id="L135">         java.net.URL urlObj = new java.net.URL(url);</span>
<span class="fc" id="L136">         String endpoint = urlObj.getPath();</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">         return endpoint.isEmpty() ? &quot;/&quot; : endpoint;</span>
<span class="fc" id="L138">      } catch (Exception e) {</span>
<span class="fc" id="L139">         return url;</span>
      }
   }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>